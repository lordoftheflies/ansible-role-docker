---



# START - boilerplate tasks

- name: "Load '{{ ansible_os_family }}' specific variables"
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ fact_role_path }}/vars/{{ ansible_os_family | lower }}.yml"
      skip: true

- name: "Run any OS specific tasks"
  include: "{{ item }}"
  with_first_found:
    - files:
        - "{{ fact_role_path }}/tasks/{{ ansible_os_family | lower }}.yml"
      skip: true

- name: "Load distribution (centos, ubuntu) default variables"
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ fact_role_path }}/defaults/{{ ansible_distribution | lower }}.yml"
      skip: true

- name: "DEBUG - Debug ansible_role_docker variable values"
  include: "{{ item }}"
  with_first_found:
    - files:
        - "{{ fact_role_path }}/tasks/debug.yml"
      skip: true
  when: ansible_role_docker_debug is defined and ansible_role_docker_debug

# END - boilerplate tasks

# OS Versions

## DEBUGGING

- name: "DEBUG - value of ansible_distribution"
  debug: var=ansible_distribution
  when: ansible_role_docker_debug

- name: "DEBUG - value of ansible_distribution_version"
  debug: var=ansible_distribution_version
  when: ansible_role_docker_debug

- name: "DEBUG - value of ansible_distribution_major_version"
  debug: var=ansible_distribution_major_version
  when: ansible_role_docker_debug

## CentOS

- name: "Run CentOS  specific tasks"
  include_tasks: "centos_{{item}}.yml"
  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version| int == item
  with_items:
    - 7
    - 8
    - 9

## Debian

- name: "Run Debian  (Stretch) specific tasks"
  include_tasks: "debian_{{ item }}.yml"
  when: ansible_distribution == 'Debian' and ansible_distribution_major_version| int == item
  with_items:
    - 7
    - 8
    - 9

## Ubuntu

- name: "Run Ubuntu specific tasks"
  include_tasks: "ubuntu_{{item}}.yml"
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_version == item
  with_items:
      - 12.04
      - 14.04
      - 16.04
      - 17.04
      - 18.04
      - 19.04

- name: "Install necessary packages"
  become: yes
  package:
    name: "{{item}}"
    state: present
  with_items: "{{ansible_role_docker.external_linux_packages}}"

- name: "Setup grub"
  include_tasks: "grub.yml"

- name: "Setup Docker runtime"
  include_tasks: "docker.yml"